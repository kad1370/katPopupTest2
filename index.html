<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>팝업 테스트 - Main</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif; padding:20px; }
    button { padding:10px 14px; font-size:16px; }
    p { color:#555; }
  </style>
</head>
<body>
  <h2>팝업 테스트 (Main)</h2>
  <p>버튼 누르면 팝업이 열리고, 팝업에서 닫기 버튼을 누르면 닫힙니다.</p>

  <button id="openPopup">팝업 열기</button>
  <p id="status"></p>
  <p id="status2"></p>

<script>
(function(){
  let popupRef = null;


  document.getElementById('openPopup').addEventListener('click', function(){
    // 팝업 옵션은 필요에 맞게 조절
    const w = 420, h = 700;
    const left = (screen.width - w) / 2;
    const top = (screen.height - h) / 2;
    // popup.html은 같은 경로에 있다고 가정
    popupRef2 = window.open('popup2.html', '_blank2', `width=${w},height=${h},left=${left},top=${top}`);

    if (!popupRef) {
      document.getElementById('status').textContent = '팝업이 차단되었습니다. 브라우저 설정을 확인하세요.';
    } else {
      document.getElementById('status').textContent = '팝업이 열렸습니다.';
      // optional: 포커스
      try { popupRef.focus(); } catch(e){}
    }

    if (!popupRef2) {
      document.getElementById('status2').textContent = '팝업2이 차단되었습니다. 브라우저 설정을 확인하세요.';
    } else {
      document.getElementById('status2').textContent = '팝업2이 열렸습니다.';
      popupRef = window.open('popup.html', '_blank', `width=${w},height=${h},left=${left},top=${top}`);

      // optional: 포커스
      try { popupRef.focus(); } catch(e){}
    }
  });


    // 오프너가 수신하는 메시지: 팝업에서 "closePopup" 요청을 보내면 실제로 닫아줌.

    window.addEventListener('message', function(e){
      try {
        if(e.data.type === 'POPUP_CLOSED') {
          alert(`${e.data.popupName} 창 닫힘`);
        }
        /*
        const data = e.data;
        if (data && data.action === 'closePopup') {
          if (popupRef && !popupRef.closed) {
            popupRef.close();
            document.getElementById('status').textContent = '팝업을 부모창에서 닫았습니다.';
          } else {
            document.getElementById('status').textContent = '팝업이 이미 닫혔거나 참조가 없습니다.';
          }
        }
        */
      } catch(err) {
        console.error(err);
      }
    }, false);
})();
</script>
</body>
</html>
